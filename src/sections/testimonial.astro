---
import ChevronLeftIcon from "../icons/chevron-left.astro";
import ChevronRightIcon from "../icons/chevron-right.astro";
import TestimonialBGImage from "../images/client_bg1.jpg";

const testimonials = [
  {
    quote:
      "Program naprawdę przypadł mi do gustu, przyjazny interfejs, łatwość obsługi, skumulowanie tylko najpotrzebniejszych funkcjonalności i to mi właśnie odpowiada...",
    author: "Mariusz W.",
  },
  {
    quote:
      "Program bardzo przejrzysty, faktura w ŚWIETNEJ szacie graficznej. POLECAM",
    author: "Dariusz S.",
  },
  {
    quote:
      "Gratuluje programu - jest czytelny, naprawdę ładnie skonstruowany :).",
    author: "Piotr M.",
  },
  {
    quote:
      "Świetny program do faktur bardzo przejrzysty jak dla mnie to bomba, od dawna takiego szukałem.",
    author: "Łukasz P.",
  },
  {
    quote:
      "Podoba mi się Państwa program, jest klarowny, profesjonalny i łatwy w użyciu.",
    author: "Grzegorz K.",
  },
];
---

<section
  style={`background-image: url(${TestimonialBGImage.src});`}
  class="py-24 text-center relative"
>
  <div class="relative max-w-5xl mx-auto px-6">
    <h2 class="text-3xl font-medium text-[#222] mb-8">Opinie Klientów</h2>

    <div class="relative overflow-hidden">
      <!-- SLIDER TRACK -->
      <div
        data-testimonial-track
        class="flex transition-transform duration-500 ease-out"
      >
        {
          testimonials.map((t) => (
            <figure class="min-w-full px-4">
              <blockquote class="text-lg text-[#222] italic mb-8 font-light leading-relaxed">
                “{t.quote}”
              </blockquote>
              <cite class="block font-semibold text-3xl not-italic text-[#222]">
                {t.author}
              </cite>
            </figure>
          ))
        }
      </div>

      <!-- DOTS -->
      <div class="flex justify-center gap-2 mt-4">
        {
          testimonials.map((_, index) => (
            <button
              type="button"
              data-testimonial-dot={index}
              class={
                index === 0
                  ? "w-2 h-2 rounded-full bg-[#007aff]"
                  : "w-2 h-2 rounded-full bg-[#209faf]"
              }
              aria-label={`Przejdź do opinii ${index + 1}`}
            />
          ))
        }
      </div>

      <!-- BUTTONS -->
      <button
        type="button"
        data-testimonial-prev
        class="absolute left-0 top-1/2 -translate-y-1/2 p-2 border hover:bg-white/20 rounded hidden md:block"
      >
        <ChevronLeftIcon />
      </button>

      <button
        type="button"
        data-testimonial-next
        class="absolute right-0 top-1/2 -translate-y-1/2 p-2 border hover:bg-white/20 rounded hidden md:block"
      >
        <ChevronRightIcon />
      </button>
    </div>
  </div>
</section>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const track = document.querySelector(
      "[data-testimonial-track]"
    ) as HTMLElement | null;
    if (!track) return;

    const slides = Array.from(track.children) as HTMLElement[];
    const dots = Array.from(
      document.querySelectorAll("[data-testimonial-dot]")
    ) as HTMLButtonElement[];

    const prevBtn = document.querySelector(
      "[data-testimonial-prev]"
    ) as HTMLButtonElement | null;
    const nextBtn = document.querySelector(
      "[data-testimonial-next]"
    ) as HTMLButtonElement | null;

    if (slides.length === 0 || dots.length === 0) return;

    let current = 0;
    const total = slides.length;

    const ACTIVE = "bg-[#007aff]";
    const INACTIVE = "bg-[#209faf]";

    const goToSlide = (index: number): void => {
      if (index < 0) index = total - 1;
      if (index >= total) index = 0;

      current = index;
      track.style.transform = `translateX(-${current * 100}%)`;

      dots.forEach((dot, i) => {
        dot.classList.remove(ACTIVE, INACTIVE);
        dot.classList.add(i === current ? ACTIVE : INACTIVE);
      });
    };

    prevBtn?.addEventListener("click", () => {
      goToSlide(current - 1);
    });

    nextBtn?.addEventListener("click", () => {
      goToSlide(current + 1);
    });

    dots.forEach((dot, index) => {
      dot.addEventListener("click", () => goToSlide(index));
    });

    // initialize slider
    goToSlide(0);
  });
</script>
